<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=800, height=480, initial-scale=1.0, user-scalable=no">
<title>EchoVault</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    background: #0d1117;
    color: #e6edf3;
    font-family: -apple-system, "Segoe UI", Helvetica, Arial, sans-serif;
    width: 800px;
    height: 480px;
    overflow: hidden;
    display: flex;
    flex-direction: column;
  }

  /* Header */
  #header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 12px 20px;
    background: #161b22;
    border-bottom: 1px solid #30363d;
    flex-shrink: 0;
  }
  #header h1 {
    font-size: 20px;
    font-weight: 600;
    color: #58a6ff;
  }
  #header .clock {
    font-size: 14px;
    color: #8b949e;
  }

  /* Status area */
  #status-area {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 16px;
    padding: 18px 20px;
    flex-shrink: 0;
    background: #161b22;
    border-bottom: 1px solid #30363d;
  }
  .indicator {
    width: 20px;
    height: 20px;
    border-radius: 50%;
    flex-shrink: 0;
  }
  .indicator.idle { background: #238636; animation: pulse 2.5s ease-in-out infinite; }
  .indicator.recording { background: #da3633; animation: pulse 0.8s ease-in-out infinite; }
  .indicator.thinking { background: #d29922; animation: spin 1s linear infinite; border-radius: 4px; }
  .indicator.speaking { background: #58a6ff; animation: pulse 1s ease-in-out infinite; }

  @keyframes pulse {
    0%, 100% { opacity: 1; transform: scale(1); }
    50% { opacity: 0.5; transform: scale(0.85); }
  }
  @keyframes spin {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
  }

  #status-text {
    font-size: 22px;
    font-weight: 500;
  }

  /* Conversation log */
  #conversation {
    flex: 1;
    overflow-y: auto;
    padding: 12px 20px;
    display: flex;
    flex-direction: column;
    gap: 10px;
  }
  #conversation::-webkit-scrollbar { width: 6px; }
  #conversation::-webkit-scrollbar-track { background: transparent; }
  #conversation::-webkit-scrollbar-thumb { background: #30363d; border-radius: 3px; }

  .message {
    padding: 10px 14px;
    border-radius: 10px;
    max-width: 85%;
    font-size: 16px;
    line-height: 1.4;
    word-wrap: break-word;
  }
  .message.user {
    background: #1f3a5f;
    align-self: flex-end;
    border-bottom-right-radius: 3px;
  }
  .message.user::before {
    content: "You";
    display: block;
    font-size: 11px;
    color: #58a6ff;
    margin-bottom: 3px;
    font-weight: 600;
  }
  .message.assistant {
    background: #1c2128;
    border: 1px solid #30363d;
    align-self: flex-start;
    border-bottom-left-radius: 3px;
  }
  .message.assistant::before {
    content: "Jarvis";
    display: block;
    font-size: 11px;
    color: #3fb950;
    margin-bottom: 3px;
    font-weight: 600;
  }

  /* Empty state */
  #empty-state {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #484f58;
    font-size: 16px;
  }
</style>
</head>
<body>

<div id="header">
  <h1>EchoVault</h1>
  <span class="clock" id="clock"></span>
</div>

<div id="status-area">
  <div class="indicator idle" id="indicator"></div>
  <span id="status-text">Listening for wake word...</span>
</div>

<div id="conversation">
  <div id="empty-state">Say "Hey Jarvis" to start a conversation</div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.5/socket.io.min.js"></script>
<script>
(function() {
  const socket = io();
  const conv = document.getElementById("conversation");
  const emptyState = document.getElementById("empty-state");
  const indicator = document.getElementById("indicator");
  const statusText = document.getElementById("status-text");
  const clock = document.getElementById("clock");

  // Clock
  function updateClock() {
    const now = new Date();
    clock.textContent = now.toLocaleTimeString([], { hour: "2-digit", minute: "2-digit" });
  }
  updateClock();
  setInterval(updateClock, 30000);

  // Status mapping
  const statusMap = {
    "idle":        { text: "Listening for wake word...",  css: "idle" },
    "wake":        { text: "Wake word detected!",         css: "recording" },
    "recording":   { text: "Recording...",                css: "recording" },
    "transcribing":{ text: "Transcribing...",             css: "thinking" },
    "thinking":    { text: "Thinking...",                 css: "thinking" },
    "speaking":    { text: "Speaking...",                  css: "speaking" },
    "listening":   { text: "Listening...",                 css: "idle" },
  };

  socket.on("status_changed", function(data) {
    const s = statusMap[data.status] || { text: data.status, css: "idle" };
    statusText.textContent = s.text;
    indicator.className = "indicator " + s.css;
  });

  function addMessage(role, text) {
    if (emptyState) emptyState.remove();
    const div = document.createElement("div");
    div.className = "message " + role;
    div.textContent = text;
    conv.appendChild(div);
    conv.scrollTop = conv.scrollHeight;
  }

  socket.on("user_message", function(data) {
    addMessage("user", data.text);
  });

  socket.on("assistant_message", function(data) {
    addMessage("assistant", data.text);
  });

  socket.on("conversation_reset", function() {
    conv.innerHTML = '<div id="empty-state">Say "Hey Jarvis" to start a conversation</div>';
  });
})();
</script>
</body>
</html>
